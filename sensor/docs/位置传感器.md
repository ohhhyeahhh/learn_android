# 位置传感器

### 总述

Android 平台提供以下两种传感器，以帮助您确定设备的位置：地磁场传感器和加速度计。Android 平台还提供一种传感器，可帮助您确定设备表面与物体的邻近程度（名为*近程传感器*）。地磁场传感器和近程传感器均基于硬件。大部分手机和平板电脑制造商都在其设备中内置地磁场传感器。同样，手机制造商通常还会在其设备中内置近程传感器，以确定手机与用户脸部的靠近程度（例如，在手机通话期间）。您可以使用设备加速度计和地磁场传感器的读数，确定设备的屏幕方向。



地磁场传感器和加速度计会为每个 `SensorEvent` 返回传感器值的多维数组。例如，地磁场传感器提供单个传感器事件中所有三个坐标轴的地磁场强度值。同样，加速度计传感器测量传感器事件中施加到设备的加速度。如需了解有关传感器所用坐标系的详细信息，请参阅[传感器坐标系](https://developer.android.google.cn/guide/topics/sensors/sensors_overview#sensors-coords)。近程传感器会为每个传感器事件提供一个值。表 1 总结了 Android 平台支持的位置传感器。

**表 1.** Android 平台支持的位置传感器。

| 传感器                             | 传感器事件数据          | 说明                                    | 度量单位 |
| :--------------------------------- | :---------------------- | :-------------------------------------- | :------- |
| `TYPE_GAME_ROTATION_VECTOR`        | `SensorEvent.values[0]` | 沿 x 轴的旋转矢量分量 (x * sin(θ/2))。  | 无单位   |
|                                    | `SensorEvent.values[1]` | 沿 y 轴的旋转矢量分量 (y * sin(θ/2))。  |          |
|                                    | `SensorEvent.values[2]` | 沿 z 轴的旋转矢量分量 (z * sin(θ/2))。  |          |
| `TYPE_GEOMAGNETIC_ROTATION_VECTOR` | `SensorEvent.values[0]` | 沿 x 轴的旋转矢量分量 (x * sin(θ/2))。  | 无单位   |
|                                    | `SensorEvent.values[1]` | 沿 y 轴的旋转矢量分量 (y * sin(θ/2))。  |          |
|                                    | `SensorEvent.values[2]` | 沿 z 轴的旋转矢量分量 (z * sin(θ/2))。  |          |
| `TYPE_MAGNETIC_FIELD`              | `SensorEvent.values[0]` | 沿 x 轴的地磁场强度。                   | 微特斯拉 |
|                                    | `SensorEvent.values[1]` | 沿 y 轴的地磁场强度。                   |          |
|                                    | `SensorEvent.values[2]` | 沿 z 轴的地磁场强度。                   |          |
| `TYPE_MAGNETIC_FIELD_UNCALIBRATED` | `SensorEvent.values[0]` | 沿 x 轴的地磁场强度（无硬铁校准功能）。 | 微特斯拉 |
|                                    | `SensorEvent.values[1]` | 沿 y 轴的地磁场强度（无硬铁校准功能）。 |          |
|                                    | `SensorEvent.values[2]` | 沿 z 轴的地磁场强度（无硬铁校准功能）。 |          |
|                                    | `SensorEvent.values[3]` | 沿 x 轴的铁偏差估算。                   |          |
|                                    | `SensorEvent.values[4]` | 沿 y 轴的铁偏差估算。                   |          |
|                                    | `SensorEvent.values[5]` | 沿 z 轴的铁偏差估算。                   |          |
| `TYPE_ORIENTATION`1                | `SensorEvent.values[0]` | 方位角（绕 z 轴的角度）。               | 度       |
|                                    | `SensorEvent.values[1]` | 俯仰角（绕 x 轴的角度）。               |          |
|                                    | `SensorEvent.values[2]` | 倾侧角（绕 y 轴的角度）。               |          |
| `TYPE_PROXIMITY`                   | `SensorEvent.values[0]` | 与物体的距离。2                         | 厘米     |

**1**Android 2.2（API 级别 8）已弃用此传感器，Android 4.4W（API 级别 20）已弃用此传感器类型。传感器框架提供用于获取设备屏幕方向的备用方法，[计算设备的屏幕方向](https://developer.android.google.cn/guide/topics/sensors/sensors_position#sensors-pos-orient)对此有所阐述。

**2** 某些近程传感器只提供二进制值来表示远和近。





### 游戏矢量传感器（TYPE_GAME_ROTATION_VECTOR）

传感器事件数据：

| SensorEvent.values[0] | 沿 x 轴的旋转矢量分量 (x * sin(θ/2))。 |
| --------------------- | -------------------------------------- |
| SensorEvent.values[1] | 沿 y 轴的旋转矢量分量 (y * sin(θ/2))。 |
| SensorEvent.values[2] | 沿 z 轴的旋转矢量分量 (z * sin(θ/2))。 |

 

游戏旋转矢量传感器不使用磁场，因此相对旋转更准确，且不受磁场变化的影响。Y 轴不指向北，而是指向其他参照坐标。该参考坐标可以漂移与陀螺仪沿 Z 轴漂移时的幅度相同数量级的幅度。

一般在无需确认地球参照系位置时使用。在需要得知北方位置时，可以使用地磁旋转矢量传感器作为替代，能耗更低，精度更低。



### 地磁旋转传感器（TYPE_GEOMAGNETIC_ROTATION_VECTOR）

传感器事件数据：

| SensorEvent.values[0] | 沿 x 轴的旋转矢量分量 (x * sin(θ/2))。 |
| --------------------- | -------------------------------------- |
| SensorEvent.values[1] | 沿 y 轴的旋转矢量分量 (y * sin(θ/2))。 |
| SensorEvent.values[2] | 沿 z 轴的旋转矢量分量 (z * sin(θ/2))。 |

 地磁旋转矢量传感器与旋转矢量传感器类似，但前者使用磁力计而非陀螺仪。此传感器的精度比普通旋转矢量传感器低，但能耗也有所降低。



### 地磁场传感器（TYPE_MAGNETIC_FIELD）

传感器事件数据：

| SensorEvent.values[0] | 沿 x 轴的地磁场强度。 |
| --------------------- | --------------------- |
| SensorEvent.values[1] | 沿 y 轴的地磁场强度。 |
| SensorEvent.values[2] | 沿 z 轴的地磁场强度。 |

此传感器提供三个坐标轴中每个坐标轴的原始场强数据（以微特斯拉为单位）。通常，您无需直接使用此传感器。您可以改用旋转矢量传感器来确定原始旋转运动，或者将加速度计和地磁场传感器与 [getRotationMatrix()](#getRotationMatrix(float[], float[], float[], float[])) 方法结合使用，以获得旋转矩阵和倾角矩阵。然后，您可以将这些矩阵与 [getOrientation()](#getOrientation(float[], float[])) 和 [getInclination()](#getInclination(float[])) 方法一起使用，以获取方位角和地磁倾斜度数据。

 

### 未经校准的磁力计(TYPE_MAGNETIC_FIELD_UNCALIBRATED)

传感器事件数据：

| `SensorEvent.values[0]` | 沿 x 轴的地磁场强度（无硬铁校准功能）。 |
| ----------------------- | --------------------------------------- |
| `SensorEvent.values[1]` | 沿 y 轴的地磁场强度（无硬铁校准功能）。 |
| `SensorEvent.values[2]` | 沿 z 轴的地磁场强度（无硬铁校准功能）。 |
| `SensorEvent.values[3]` | 沿 x 轴的铁偏差估算。                   |
| `SensorEvent.values[4]` | 沿 y 轴的铁偏差估算。                   |
| `SensorEvent.values[5]` | 沿 z 轴的铁偏差估算。                   |

未经校准的磁力计与地磁场传感器类似，不同之处在于未对磁场应用硬铁校准。出厂校准和温度补偿仍应用于磁场。未经校准的磁力计可用于处理不良的硬铁估算。通常，geomagneticsensor_event.values[0] 将接近uncalibrated_magnetometer_event.values[0] - uncalibrated_magnetometer_event.values[3]。即，calibrated_x ~= uncalibrated_x - bias_estimate_x

除磁场外，未经校准的磁力计还提供每个轴上的估算硬铁偏差。以下代码展示如何获取默认未经校准的磁力计的实例：

```java
private SensorManager sensorManager;
private Sensor sensor;
...
sensorManager = (SensorManager) getSystemService(Context.SENSOR_SERVICE);
sensor = sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD_UNCALIBRATED);
```



### 近程传感器（TYPE_PROXIMITY）

传感器事件数据：

|                         |                |
| ----------------------- | -------------- |
| `SensorEvent.values[0]` | 与物体的距离。 |

近程传感器可让您确定物体与设备的距离（单位厘米）。近程传感器通常用于确定人的头部距手持设备表面的距离（例如，当用户拨打或接听电话时）。大多数近程传感器返回以厘米为单位的绝对距离，但有些仅返回近距离和远距离值。

**注意**：某些传感器返回二进制值来表示“近”或“远”。在这种情况下，传感器通常会在远距离状态下报告其最大范围值，而在近距离状态下报告较小的值。通常，远距离值是一个大于 5 cm 的值，但这可能因传感器而异。您可以使用 getMaximumRange() 方法确定传感器的最大范围。